<h2 mat-dialog-title>{{ data.model.id ? 'Edit' : 'Add' }} {{ data.title }}</h2>
<mat-dialog-content>

  @if (fileSelectorVisible) {
    <div class="bordered">
      <file-tree
        [onlyFiles]="true"
        [value]="originalFilenameControl.value"
        (close)="fileSelectorVisible = false"
        (valueChange)="fileSelected($event)"
        (close)="hideFileSelector()">
      </file-tree>
    </div>
  } @else if (fieldForTranslate == null) {
    <form *ngIf="data.columns.length" [formGroup]="form" id="edit-form">
      @for (column of columns; track column.field) {
        <div>
          @if (column.type === 'date') {
            <!-- for some reason styles don't work if this is done similarly -->
            <mat-form-field>
              <mat-label>{{ column.header }}</mat-label>
              <input matInput [formControlName]="column.field" [matDatepicker]="picker"/>
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          } @else {
            @if (column.field === 'cascade_published') {
              <div *ngIf="data.model?.id" [ngStyle]="{'margin-bottom': '20px'}">
                <mat-slide-toggle formControlName="cascade_published">{{ column.header }}</mat-slide-toggle>
              </div>
            } @else {
              <mat-form-field>
                <mat-label>{{ column.header }}</mat-label>
                @if (column.type === 'boolean') {
                  <mat-select [formControlName]="column.field">
                    <mat-option>Any</mat-option>
                    <mat-option [value]="0">No</mat-option>
                    <mat-option [value]="1">Yes</mat-option>
                  </mat-select>
                } @else if (column.type === 'type') {
                  <mat-select [formControlName]="column.field">
                    <mat-option>Any</mat-option>
                    @for (type of personTypes; track type.value) {
                      <mat-option [value]="type.value">{{ type.label }}</mat-option>
                    }
                  </mat-select>
                } @else if (column.type === 'published') {
                  <mat-select [formControlName]="column.field">
                    <mat-option>Any</mat-option>
                    <mat-option [value]="0">Not published</mat-option>
                    <mat-option [value]="1">Internally</mat-option>
                    <mat-option [value]="2">Externally</mat-option>
                  </mat-select>
                } @else if (column.type === 'textarea') {
                  <textarea
                    matInput
                    [formControlName]="column.field"
                    cdkTextareaAutosize
                    #autosize="cdkTextareaAutosize"
                    cdkAutosizeMinRows="1"
                    cdkAutosizeMaxRows="7"
                    ></textarea>
                } @else if (column.type === 'number') {
                  <input matInput [formControlName]="column.field" type="number"/>
                } @else {
                  <input matInput
                    [formControlName]="column.field"
                    type="text"
                    [placeholder]="column.field === 'date_born' || column.field === 'date_deceased' ? 'YYYY or YYYY-MM-DD' : ''" />
                }
              </mat-form-field>
          }
          }
          @if (column.translations && data.model?.id) {
            <div class="translations">
              <button mat-flat-button type="button" (click)="showTranslations(column)"><mat-icon>language</mat-icon>{{column.header}} translations</button>
            </div>
          }
          @if (column.field === 'original_filename') {
            <div class="translations">
              <button mat-flat-button type="button" (click)="showFileSelector()"><mat-icon>folder</mat-icon>Choose file</button>
            </div>
          }
        </div>
      }
    </form>
  } @else {
    <field-translations [field]="fieldForTranslate" [data]="data.model" (close)="fieldForTranslate = null"></field-translations>
  }
</mat-dialog-content>
<mat-dialog-actions>
  <button mat-button mat-dialog-close>Cancel</button>
  <button
    *ngIf="form"
    mat-button
    [mat-dialog-close]="{ type: data.model.id ? 'Edit' : 'Add', form }"
    type="button"
    [disabled]="!form.valid || fieldForTranslate != null || fileSelectorVisible"
    form="edit-form">
      {{ data.model.id ? 'Save' : 'Add' }}
    </button>
</mat-dialog-actions>
