@let facsimile = facsimile$ | async;
@let missingFileNumbersValue = missingFileNumbers();
@let missingFileSetValue = missingFileSet();

<h1>Facsimile collection management</h1>
<div class="selected-facsimile-collection">
  <a matIconButton [routerLink]="['/facsimiles']" [queryParamsHandling]="'preserve'">
    <mat-icon>west</mat-icon>
  </a>
  <h2>{{ facsimile?.title || '' }} (ID {{ facsimile?.id }}{{ facsimile?.description ? '; ' + facsimile?.description : '' }})</h2>
</div>

@if (loadingFacsData()) {
  <loading-spinner></loading-spinner>
} @else {
  @if (facsimile && facsimile.number_of_pages) {
    <h3>Images in the facsimile collection ({{ facsimile.number_of_pages }})</h3>

    <div class="actions-row">
      @if (missingFileNumbersValue.length) {
        <a
          matButton="filled"
          [routerLink]="['/facsimiles', facsimile?.id, 'upload-missing']"
        >Add missing ({{ missingFileNumbersValue.length }})</a>
      }

      @if (missingFileNumbersValue.length !== facsimile.number_of_pages) {
        <a
          matButton="filled"
          [routerLink]="['/facsimiles', facsimile?.id, 'upload-all']"
        >Replace all ({{ facsimile.number_of_pages }})</a>

        <a
          matButton="filled"
          [routerLink]="['/facsimiles', facsimile?.id, 'upload-selection']"
        >
          Replace selection
        </a>
      }
    </div>

    <div class="images">
      @for (page of pageNumbers(); track page) {
        <div class="image">
          <div>{{ page }}</div>
          @if (missingFileSetValue.has(page)) {
            <mat-icon class="img-icon error">block</mat-icon>
          } @else {
            <mat-icon class="img-icon success">check_circle</mat-icon>
          }
        </div>
      } @empty {
        <p>No images.</p>
      }
    </div>

  }
}
