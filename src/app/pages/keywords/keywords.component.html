@let isLoading = loading$ | async;

<div class="header">
  <h1>Keywords management</h1>
  <p>Manage keywords for the current project. Keywords can be organized into categories and used to tag publications.</p>
</div>

@if (!projectName()) {
  <p>Please select a project.</p>
} @else {
  <div class="filters-section" [formGroup]="filters">
    <mat-form-field class="search-field" [subscriptSizing]="'dynamic'">
      <mat-label>Search keywords</mat-label>
      <input matInput formControlName="search">
      @if (searchCtrl.value | isEmptyString) {
        <mat-icon matSuffix>search</mat-icon>
      } @else {
        <button matIconButton
          matSuffix
          aria-label="Clear search term"
          (click)="clearSearchControl()"
        >
          <mat-icon>clear</mat-icon>
        </button>
      }
    </mat-form-field>

    <mat-form-field class="category-filter-field" [subscriptSizing]="'dynamic'">
      <mat-label>Filter by category</mat-label>
      <mat-select formControlName="category">
        <mat-option value="">All categories</mat-option>
        @for (category of categories$ | async; track category) {
          <mat-option [value]="category">{{ category }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <button class="clear-filters-btn"
      matButton="outlined"
      [disabled]="!hasFilters()"
      (click)="clearFilters()"
    >
      <mat-icon>clear</mat-icon>
      Clear filters
    </button>
  </div>

  <custom-table
    [data$]="filteredKeywords$"
    [columns]="keywordColumnsData"
    (editRow)="editKeyword($event)"
    (deleteRow)="deleteKeyword($event)"
  >
    <ng-content custom-table-title>Keywords</ng-content>
    <ng-content custom-table-actions>
      <button matButton="filled" (click)="addKeyword()" [disabled]="isLoading"><mat-icon>add</mat-icon>Add</button>
    </ng-content>
  </custom-table>

  @if (isLoading) {
    <loading-spinner [overlay]="true"></loading-spinner>
  }
}
